# Prompty V2 - 用户使用指南

**版本**: 2.0.0
**更新时间**: 2025-11-01

---

## 📖 目录

1. [快速开始](#快速开始)
2. [核心功能](#核心功能)
3. [详细使用说明](#详细使用说明)
4. [高级功能](#高级功能)
5. [常见问题](#常见问题)
6. [最佳实践](#最佳实践)
7. [故障排除](#故障排除)

---

## 🚀 快速开始

### 第一步：打开应用

在浏览器中打开 `app.html` 文件：

```bash
# 命令行打开
open app.html

# 或直接双击文件
```

**系统要求**:
- 现代浏览器（Chrome 90+, Firefox 88+, Safari 14+, Edge 90+）
- 无需安装任何软件
- 无需后端服务器

### 第二步：上传文件

1. 找到左侧侧边栏的**文件上传区**
2. 点击或拖拽 HTML 文件到上传区
3. 支持一次上传多个文件

**支持的文件类型**:
- `.html` - HTML 文件
- `.htm` - HTML 文件
- `.css` - CSS 样式文件
- `.js` - JavaScript 文件

### 第三步：执行查询

1. 在顶部输入框输入自然语言查询
2. 例如："找到所有导航"
3. 点击 🔍 按钮或按 Enter 键
4. 查看查询结果

### 第四步：创建修改

1. 在查询结果中点击 **✏️ 创建修改** 按钮
2. 选择修改类型（1-4）
3. 输入修改参数
4. 查看预览
5. 点击 **✓ 应用修改** 确认

---

## 🎯 核心功能

### 1. 文件管理

#### 上传文件
- **拖拽上传**: 直接拖拽文件到上传区
- **点击上传**: 点击上传区选择文件
- **多文件上传**: 一次选择多个文件

#### 版本管理
- **自动创建版本**: 每次上传自动创建新版本
- **版本切换**: 点击版本列表切换不同版本
- **版本历史**: 查看所有版本及创建时间

### 2. 自然语言查询

#### 查询语法

**基本查询**:
```
找到所有导航
```

**精确查询**:
```
找到首页的购买按钮
```

**批量查询**:
```
找到所有链接
```

**语义查询**:
```
找到主要内容区域
```

#### 查询示例

| 查询 | 说明 |
|------|------|
| 找到所有导航 | 查找所有 nav 元素 |
| 找到首页的购买按钮 | 查找特定页面的按钮 |
| 找到所有链接 | 查找所有 a 标签 |
| 找到页脚 | 查找页脚元素 |

### 3. 代码修改

#### 修改类型

**1. 修改样式 (setStyle)**

修改元素的 CSS 样式。

**示例输入**:
```json
{
  "background": "#001f3f",
  "color": "#ffffff",
  "padding": "15px"
}
```

**2. 修改属性 (setAttribute)**

修改元素的 HTML 属性。

**示例输入**:
```json
{
  "class": "new-class",
  "id": "new-id",
  "data-value": "123"
}
```

**3. 修改内容 (setContent)**

修改元素的文本内容。

**示例输入**:
```
新的文本内容
```

**4. 删除元素 (delete)**

删除选中的元素。

**示例**: 直接确认删除，无需额外输入。

### 4. 预览和应用

#### 预览功能
- **差异对比**: 查看修改前后的差异
- **颜色编码**:
  - 🟢 绿色：新增内容
  - 🔴 红色：删除内容
  - 🟡 黄色：修改内容
- **统计信息**: 查看修改的行数统计

#### 应用修改
- **事务性应用**: 全部成功或全部失败
- **自动回滚**: 失败时自动恢复
- **历史记录**: 可查看修改历史

---

## 📚 详细使用说明

### 完整工作流程

#### 步骤 1: 准备文件

准备好你的 HTML 文件，确保：
- 文件编码为 UTF-8
- HTML 结构完整
- 无严重语法错误

#### 步骤 2: 上传和索引

1. 打开 app.html
2. 上传 HTML 文件
3. 等待系统自动构建索引（通常 1-3 秒）
4. 查看侧边栏确认文件已上传

#### 步骤 3: 查询元素

**方法 A: 使用示例查询**
1. 点击输入框下方的示例标签
2. 自动填充查询文本
3. 点击执行

**方法 B: 自定义查询**
1. 在输入框输入自然语言
2. 描述你要查找的元素
3. 按 Enter 或点击执行

#### 步骤 4: 查看结果

查询结果卡片包含：
- **文件路径**: 元素所在的文件
- **匹配度**: 查询匹配的准确度（%）
- **元素信息**: 标签、选择器、语义类型
- **代码预览**: 元素的代码片段

#### 步骤 5: 创建修改

1. 点击结果卡片的 **✏️ 创建修改** 按钮
2. 在弹出对话框中选择修改类型（1-4）
3. 根据类型输入参数：
   - **样式/属性**: JSON 格式
   - **内容**: 纯文本
   - **删除**: 无需输入，直接确认

#### 步骤 6: 预览修改

如果启用了"自动预览"（在设置中）：
- 系统自动显示预览
- 查看修改前后的差异
- 确认无误后点击"应用"

如果未启用自动预览：
- 会弹出确认对话框
- 选择"是"查看预览

#### 步骤 7: 应用修改

1. 在预览窗口点击 **✓ 应用修改**
2. 确认操作
3. 等待系统应用修改
4. 查看成功提示

---

## 🔧 高级功能

### 1. LLM 智能辅助（可选）

#### 配置 API Key

1. 点击顶部的 **⚙️ 设置** 按钮
2. 输入 OpenRouter API Key
3. 选择 LLM 模型：
   - Claude 3.5 Sonnet（推荐）
   - GPT-4
   - GPT-3.5 Turbo
4. 点击保存

#### 获取 API Key

1. 访问 [OpenRouter.ai](https://openrouter.ai/)
2. 注册账号
3. 创建 API Key
4. 复制 Key 到设置中

#### LLM 功能

- **意图提取**: 更准确地理解查询意图
- **智能消歧**: 多个匹配时自动选择最相关的
- **代码生成**: 生成修改建议

**注意**:
- LLM 功能是可选的
- 不使用 LLM 也能完成所有基本功能
- 使用 LLM 会产生少量费用（< $0.01/查询）

### 2. 批量修改

#### 创建批量修改

1. 执行一个能匹配多个元素的查询
   - 例如："找到所有导航"
2. 对每个结果创建修改
3. 所有修改会自动合并
4. 一次性应用所有修改

#### 批量修改示例

**场景**: 修改所有导航的样式

```
查询: "找到所有导航"
结果: 3 个导航元素

对每个元素：
1. 点击"创建修改"
2. 选择"修改样式"
3. 输入相同的样式

最终: 3 个修改操作同时应用
```

### 3. 版本管理

#### 创建新版本

每次上传文件都会自动创建新版本。

#### 切换版本

1. 在左侧侧边栏查看版本列表
2. 点击任意版本切换
3. 查询和修改都在当前版本上进行

#### 版本信息

每个版本显示：
- 版本名称（上传时间）
- 创建时间
- 版本 ID

### 4. 设置选项

#### 可用设置

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| API Key | OpenRouter API Key | 空 |
| LLM 模型 | 使用的模型 | Claude 3.5 Sonnet |
| 自动预览 | 创建修改后自动显示预览 | 关闭 |

#### 持久化

所有设置保存在浏览器的 localStorage 中，关闭浏览器后仍然保留。

---

## 💡 最佳实践

### 1. 查询技巧

**清晰描述**:
```
✅ 好: "找到首页的购买按钮"
❌ 差: "找按钮"
```

**使用语义词汇**:
```
✅ 好: "找到导航栏"
❌ 差: "找到 nav"
```

**批量查询时使用"所有"**:
```
✅ 好: "找到所有链接"
❌ 差: "找到链接"
```

### 2. 修改建议

**样式修改使用 JSON**:
```json
{
  "background": "#001f3f",
  "color": "#ffffff",
  "padding": "15px",
  "border-radius": "8px"
}
```

**属性修改注意引号**:
```json
{
  "class": "btn btn-primary",
  "data-id": "123"
}
```

**大批量修改前先预览**:
- 建议启用"自动预览"
- 确认无误再应用

### 3. 文件组织

**推荐的文件结构**:
```
project/
├── index.html
├── about.html
├── contact.html
├── styles/
│   └── main.css
└── scripts/
    └── main.js
```

**一次性上传相关文件**:
- 同一个网站的所有页面一起上传
- 便于管理和切换

### 4. 性能优化

**大文件处理**:
- 单个文件建议 < 1MB
- 总文件数建议 < 50 个
- 超大项目考虑分批处理

**定期清理**:
- 不需要的版本可以删除
- 清除浏览器缓存可释放空间

---

## ❓ 常见问题

### Q1: 上传文件后没有反应？

**可能原因**:
1. 文件格式不支持
2. 文件编码问题
3. HTML 语法错误严重

**解决方法**:
1. 确保文件是 `.html`, `.htm`, `.css`, `.js` 格式
2. 检查文件编码是否为 UTF-8
3. 使用 HTML 验证器检查语法
4. 查看浏览器控制台错误信息

### Q2: 查询没有结果？

**可能原因**:
1. 查询词不够准确
2. 文件中确实没有匹配的元素
3. 索引未完成

**解决方法**:
1. 尝试更清晰的查询词
2. 使用示例查询测试
3. 等待索引完成（查看状态栏）
4. 检查文件内容是否正确

### Q3: 修改应用失败？

**可能原因**:
1. 选择器无效
2. 修改参数格式错误
3. 文件被锁定

**解决方法**:
1. 检查 JSON 格式是否正确
2. 查看错误提示信息
3. 尝试重新上传文件
4. 查看浏览器控制台日志

### Q4: API Key 无效？

**解决方法**:
1. 检查 Key 是否完整复制
2. 确认 Key 以 `sk-or-v1-` 开头
3. 在 OpenRouter 网站检查 Key 状态
4. 重新生成新的 Key

### Q5: 预览显示异常？

**可能原因**:
1. 浏览器兼容性问题
2. 修改过于复杂
3. CSS 冲突

**解决方法**:
1. 使用最新版本的 Chrome/Firefox
2. 分步骤进行修改
3. 检查生成的 HTML 代码

---

## 🔍 故障排除

### 日志查看

打开浏览器开发者工具（F12）查看详细日志：

1. **Console（控制台）**: 查看错误信息和日志
2. **Network（网络）**: 查看 API 请求（如果使用 LLM）
3. **Application（应用）**: 查看 localStorage 和数据库

### 常见错误代码

| 错误 | 说明 | 解决方法 |
|------|------|---------|
| `Database initialization failed` | 数据库初始化失败 | 刷新页面重试 |
| `Parser not ready` | 解析器未就绪 | 等待初始化完成 |
| `File not found` | 文件未找到 | 检查文件路径 |
| `Invalid modification` | 修改操作无效 | 检查修改参数 |

### 重置应用

如果遇到无法解决的问题：

1. 清除浏览器缓存
2. 清除 localStorage:
   ```javascript
   localStorage.clear()
   ```
3. 重新加载页面
4. 重新上传文件

---

## 📞 获取帮助

### 应用内帮助

点击顶部的 **❓ 帮助** 按钮查看快速帮助。

### 文档

- [README.md](README.md) - 项目说明
- [PHASE4_COMPLETE.md](PHASE4_COMPLETE.md) - Phase 4 功能详解
- [PROGRESS_REPORT.md](PROGRESS_REPORT.md) - 开发进度

### 反馈问题

- GitHub Issues: https://github.com/your-repo/prompty/issues
- 提供详细的错误信息和复现步骤

---

## 🎓 教程视频（计划中）

未来将提供视频教程，包括：
- 快速入门（5 分钟）
- 高级功能（15 分钟）
- 实战案例（30 分钟）

---

## 📝 更新日志

### Version 2.0.0 (2025-11-01)
- ✅ 完整的 Web 应用界面
- ✅ 自然语言查询
- ✅ 可视化代码修改
- ✅ 差异预览
- ✅ LLM 智能辅助

---

**祝你使用愉快！** 🎉

如有任何问题，欢迎随时反馈！
